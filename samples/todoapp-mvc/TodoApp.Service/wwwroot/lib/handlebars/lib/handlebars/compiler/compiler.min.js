/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/handlebars@4.7.8/lib/handlebars/compiler/compiler.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Exception from"../exception";import{isArray,indexOf,extend}from"../utils";import AST from"./ast";const slice=[].slice;export function Compiler(){}Compiler.prototype={compiler:Compiler,equals:function(t){let e=this.opcodes.length;if(t.opcodes.length!==e)return!1;for(let o=0;o<e;o++){let e=this.opcodes[o],s=t.opcodes[o];if(e.opcode!==s.opcode||!argEquals(e.args,s.args))return!1}e=this.children.length;for(let o=0;o<e;o++)if(!this.children[o].equals(t.children[o]))return!1;return!0},guid:0,compile:function(t,e){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=e,this.stringParams=e.stringParams,this.trackIds=e.trackIds,e.blockParams=e.blockParams||[],e.knownHelpers=extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},e.knownHelpers),this.accept(t)},compileProgram:function(t){let e=(new this.compiler).compile(t,this.options),o=this.guid++;return this.usePartial=this.usePartial||e.usePartial,this.children[o]=e,this.useDepths=this.useDepths||e.useDepths,o},accept:function(t){if(!this[t.type])throw new Exception("Unknown type: "+t.type,t);this.sourceNode.unshift(t);let e=this[t.type](t);return this.sourceNode.shift(),e},Program:function(t){this.options.blockParams.unshift(t.blockParams);let e=t.body,o=e.length;for(let t=0;t<o;t++)this.accept(e[t]);return this.options.blockParams.shift(),this.isSimple=1===o,this.blockParams=t.blockParams?t.blockParams.length:0,this},BlockStatement:function(t){transformLiteralToPath(t);let e=t.program,o=t.inverse;e=e&&this.compileProgram(e),o=o&&this.compileProgram(o);let s=this.classifySexpr(t);"helper"===s?this.helperSexpr(t,e,o):"simple"===s?(this.simpleSexpr(t),this.opcode("pushProgram",e),this.opcode("pushProgram",o),this.opcode("emptyHash"),this.opcode("blockValue",t.path.original)):(this.ambiguousSexpr(t,e,o),this.opcode("pushProgram",e),this.opcode("pushProgram",o),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock(t){let e=t.program&&this.compileProgram(t.program),o=this.setupFullMustacheParams(t,e,void 0),s=t.path;this.useDecorators=!0,this.opcode("registerDecorator",o.length,s.original)},PartialStatement:function(t){this.usePartial=!0;let e=t.program;e&&(e=this.compileProgram(t.program));let o=t.params;if(o.length>1)throw new Exception("Unsupported number of partial arguments: "+o.length,t);o.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):o.push({type:"PathExpression",parts:[],depth:0}));let s=t.name.original,i="SubExpression"===t.name.type;i&&this.accept(t.name),this.setupFullMustacheParams(t,e,void 0,!0);let p=t.indent||"";this.options.preventIndent&&p&&(this.opcode("appendContent",p),p=""),this.opcode("invokePartial",i,s,p),this.opcode("append")},PartialBlockStatement:function(t){this.PartialStatement(t)},MustacheStatement:function(t){this.SubExpression(t),t.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator(t){this.DecoratorBlock(t)},ContentStatement:function(t){t.value&&this.opcode("appendContent",t.value)},CommentStatement:function(){},SubExpression:function(t){transformLiteralToPath(t);let e=this.classifySexpr(t);"simple"===e?this.simpleSexpr(t):"helper"===e?this.helperSexpr(t):this.ambiguousSexpr(t)},ambiguousSexpr:function(t,e,o){let s=t.path,i=s.parts[0],p=null!=e||null!=o;this.opcode("getContext",s.depth),this.opcode("pushProgram",e),this.opcode("pushProgram",o),s.strict=!0,this.accept(s),this.opcode("invokeAmbiguous",i,p)},simpleSexpr:function(t){let e=t.path;e.strict=!0,this.accept(e),this.opcode("resolvePossibleLambda")},helperSexpr:function(t,e,o){let s=this.setupFullMustacheParams(t,e,o),i=t.path,p=i.parts[0];if(this.options.knownHelpers[p])this.opcode("invokeKnownHelper",s.length,p);else{if(this.options.knownHelpersOnly)throw new Exception("You specified knownHelpersOnly, but used the unknown helper "+p,t);i.strict=!0,i.falsy=!0,this.accept(i),this.opcode("invokeHelper",s.length,i.original,AST.helpers.simpleId(i))}},PathExpression:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);let e=t.parts[0],o=AST.helpers.scopedId(t),s=!t.depth&&!o&&this.blockParamIndex(e);s?this.opcode("lookupBlockParam",s,t.parts):e?t.data?(this.options.data=!0,this.opcode("lookupData",t.depth,t.parts,t.strict)):this.opcode("lookupOnContext",t.parts,t.falsy,t.strict,o):this.opcode("pushContext")},StringLiteral:function(t){this.opcode("pushString",t.value)},NumberLiteral:function(t){this.opcode("pushLiteral",t.value)},BooleanLiteral:function(t){this.opcode("pushLiteral",t.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(t){let e=t.pairs,o=0,s=e.length;for(this.opcode("pushHash");o<s;o++)this.pushParam(e[o].value);for(;o--;)this.opcode("assignToHash",e[o].key);this.opcode("popHash")},opcode:function(t){this.opcodes.push({opcode:t,args:slice.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(t){t&&(this.useDepths=!0)},classifySexpr:function(t){let e=AST.helpers.simpleId(t.path),o=e&&!!this.blockParamIndex(t.path.parts[0]),s=!o&&AST.helpers.helperExpression(t),i=!o&&(s||e);if(i&&!s){let e=t.path.parts[0],o=this.options;o.knownHelpers[e]?s=!0:o.knownHelpersOnly&&(i=!1)}return s?"helper":i?"ambiguous":"simple"},pushParams:function(t){for(let e=0,o=t.length;e<o;e++)this.pushParam(t[e])},pushParam:function(t){let e=null!=t.value?t.value:t.original||"";if(this.stringParams)e.replace&&(e=e.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",e,t.type),"SubExpression"===t.type&&this.accept(t);else{if(this.trackIds){let o;if(!t.parts||AST.helpers.scopedId(t)||t.depth||(o=this.blockParamIndex(t.parts[0])),o){let e=t.parts.slice(1).join(".");this.opcode("pushId","BlockParam",o,e)}else e=t.original||e,e.replace&&(e=e.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",t.type,e)}this.accept(t)}},setupFullMustacheParams:function(t,e,o,s){let i=t.params;return this.pushParams(i),this.opcode("pushProgram",e),this.opcode("pushProgram",o),t.hash?this.accept(t.hash):this.opcode("emptyHash",s),i},blockParamIndex:function(t){for(let e=0,o=this.options.blockParams.length;e<o;e++){let o=this.options.blockParams[e],s=o&&indexOf(o,t);if(o&&s>=0)return[e,s]}}};export function precompile(t,e,o){if(null==t||"string"!=typeof t&&"Program"!==t.type)throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+t);"data"in(e=e||{})||(e.data=!0),e.compat&&(e.useDepths=!0);let s=o.parse(t,e),i=(new o.Compiler).compile(s,e);return(new o.JavaScriptCompiler).compile(i,e)}export function compile(t,e={},o){if(null==t||"string"!=typeof t&&"Program"!==t.type)throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+t);let s;function i(){let s=o.parse(t,e),i=(new o.Compiler).compile(s,e),p=(new o.JavaScriptCompiler).compile(i,e,void 0,!0);return o.template(p)}function p(t,e){return s||(s=i()),s.call(this,t,e)}return"data"in(e=extend({},e))||(e.data=!0),e.compat&&(e.useDepths=!0),p._setup=function(t){return s||(s=i()),s._setup(t)},p._child=function(t,e,o,p){return s||(s=i()),s._child(t,e,o,p)},p}function argEquals(t,e){if(t===e)return!0;if(isArray(t)&&isArray(e)&&t.length===e.length){for(let o=0;o<t.length;o++)if(!argEquals(t[o],e[o]))return!1;return!0}}function transformLiteralToPath(t){if(!t.path.parts){let e=t.path;t.path={type:"PathExpression",data:!1,depth:0,parts:[e.original+""],original:e.original+"",loc:e.loc}}}
//# sourceMappingURL=/sm/19f6dcb991f14a841a855021fade6280fb51353892c2c28fe86accf74f5ec58d.map